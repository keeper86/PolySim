# Benchmarks

This directory contains benchmark descriptions and a small runner used to execute `bench_program` scenarios and collect run artifacts.

## Building

From the repository root you can configure and build the polytrace project; the `bench_program` target is part of the Make build. The built binary will be available at:

```
tools/polytrace/build/bin/bench_program
```

## Configuration

`bench_program <path>` loads the JSON configuration from the path with following supported JSON keys and their types:

- `mode` (string): one of `write`, `read`, `create`, `unlink`, `cpu`, `sleep`
- `path` (string): directory path used for file operations (created if missing)
- `files` (integer): number of files per worker
- `file_size` (integer): total bytes written/read per file
- `write_size` (integer): chunk size for each write/read syscall
- `iterations` (integer): number of iterations per worker
- `threads` (integer): number of worker threads (ignored if `fork_children` > 0)
- `fork_children` (integer): number of forked child processes to spawn (useful for multi-PID tracing)
- `fsync_after_write` (boolean): call `fsync` after each file write
- `sleep_ms` (integer): milliseconds to sleep between iterations
- `cpu_ms` (integer): milliseconds of busy CPU work per iteration

Note: reading/writing files will create files named `bench_w<worker_id>_<file_index>` in the specified `path`. So a before running in "read" mode, make sure the files exist (e.g. by running first in "write" mode).


## Usage:

- `run_bench.sh` - simple runner script. It runs all given benchmark-JSON files in the directory and collects results into a CSV file. (run and install `shellcheck` to check the script)

- `plot_results.gnuplot` - gnuplot script to plot results from the CSV file generated by `run_bench.sh`. Install gnuplot and run `gnuplot plot_results.gnuplot` to generate a PNG plot.