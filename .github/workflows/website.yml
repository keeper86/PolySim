name: website

on:
    push:

defaults:
    run:
        working-directory: ./

jobs:
    formatAndLint:
        name: Check format and lint
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5
            - name: Use Node.js ${{ matrix.node-version }}
              uses: actions/setup-node@v5
              with:
                  node-version: lts/*
            - uses: actions/cache@v3
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('website/**/package-lock.json') }}
            - run: npm ci
            - run: npm run format:check
            - run: npm run lint:check

    unitTests:
        name: Unit Tests
        timeout-minutes: 10
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5
            - uses: actions/setup-node@v5
              with:
                  node-version: lts/*
            - name: Cache .npm
              uses: actions/cache@v3
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('website/**/package-lock.json') }}
            - name: Install dependencies
              run: npm ci
            - name: Run tests
              run: npm run test

    buildAndDeploy:
        name: Build
        needs: [formatAndLint, unitTests]
        runs-on: ubuntu-latest
        steps:
            - uses: actions/checkout@v5
            - uses: actions/setup-node@v5
              with:
                  node-version: lts/*
            - name: Cache .npm
              uses: actions/cache@v3
              with:
                  path: ~/.npm
                  key: ${{ runner.os }}-node-${{ hashFiles('website/**/package-lock.json') }}
            - name: Install dependencies
              run: npm ci
            - name: Run build
              run: npm run build
